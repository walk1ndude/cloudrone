var PAGE = { 
  pages : {},
  currentPage : '',
  
  createPages : function() {
    var header = ['Main', 'Main', 'Main', 'SelectDrone', 'FlyTask', 'Monitoring', 'Result'];
    var content = ['Main', 'About', 'Register', 'SelectDrone', 'FlyTask', 'Monitoring', 'Result'];

    for (var i in header) {
      this.pages[content[i]] = {
	'header' : $('#header' + header[i]),
        'content' : $('#content' + content[i])
      }
    }   
  },
  
  showPage : function(pagename) { 
    if (!!this.currentPage) {
      this.pages[this.currentPage].header.hide();
      this.pages[this.currentPage].content.hide();
    }
    
    this.pages[pagename].header.show();
    this.pages[pagename].content.show();
  
    this.currentPage = pagename;
  },
  
  setVisibility : function(params) {
    params.domElement.on('click', function(event) {
      PAGE.showPage(params.page);
      
      var hide = params.domHide;
      if (hide) {
	params.domHide.hide();
      }
	
      var map = params.map;
      if (map) {
	CLOUDRONE.maps[map].invalidateSize(false);
      }
      
      var flags = params.flags;
      if (flags.showTable) {
	WORKER_COMM.doShowDrones({
	  show : CLOUDRONE.SHOWPARAMS.SHOW_ALL
	},
	CLOUDRONE.templates.drone_show);
      }
      
      if (flags.showResults) {
	WORKER_COMM.initResults();
      }
    });
  },
  
  setPages : function() {
    this.createPages();
 
    this.setVisibility({
      domElement : $('#lMain'),
      page : 'Main'
    });
    
    this.setVisibility({
      domElement : $('#lAbout'),
      page : 'About'
    });
    
    this.setVisibility({
      domElement : $('#lRegister'),
      page : 'Register'
    });
    
    this.setVisibility({
      domElement : $('#lSelectDroneMain'),
      page : 'SelectDrone',
      domHide : $('#droneStateControl'),
      flags : {
	showTable : true
      }
    });
    
    this.setVisibility({
      domElement : $('#lSelectDroneFlyTask'),
      page : 'SelectDrone',
      domHide : $('#droneStateControl'),
      map : 'taskMap',
      flags : {
	showTable : true
      }
    });
    
    this.setVisibility({
      domElement : $('#lFlyTask'),
      page : 'FlyTask',
      map : 'taskMap'
    });
    
    this.setVisibility({
      domElement : $('#lMonitoringFlyTask'),
      page : 'Monitoring',
      map : 'monitorMap'
    });
    
    this.setVisibility({
      domElement : $('#lResultFlyTask'),
      page : 'Result',
      // map : 'resultMap',
      flags : {
	showResults : true
      }
    });
    
    this.setVisibility({
      domElement : $('#lSelectDroneMonitoring'),
      page : 'SelectDrone',
      domHide : $('#droneStateControl'),
      flags : {
	showTable : true
      }
    });
    
    this.setVisibility({
      domElement : $('#lFlyTaskMonitoring'),
      page : 'FlyTask',
      map : 'taskMap'
    });
    
    this.setVisibility({
      domElement : $('#lMonitoring'),
      page : 'Monitoring',
      map : 'monitorMap'
    });
    
    this.setVisibility({
      domElement : $('#lResultMonitoring'),
      page : 'Result',
     // map : 'resultMap',
      flags : {
	showResults : true
      }
    });

    this.setVisibility({
      domElement : $('#lSelectDroneResult'),
      page : 'SelectDrone',
      domHide : $('#droneStateControl'),
      flags : {
	showTable : true
      }
    });
    
    this.setVisibility({
      domElement : $('#lFlyTaskResult'),
      page : 'FlyTask',
      map : 'taskMap'
    });
    
    this.setVisibility({
      domElement : $('#lMonitoringResult'),
      page : 'Monitoring',
      map : 'monitorMap'
    });
    
    this.setVisibility({
      domElement : $('#lResult'),
      page : 'Result',
      //map : 'resultMap',
      flags : {
	showResults : true
      }
    });
  },
  
  fetchRadioSelectDrones : function() {
    $('input:radio[name="showDrones"]').change(function() {
      if ($(this).val() == 'showDronesAll') {
	WORKER_COMM.doShowDrones({
	  show : CLOUDRONE.SHOWPARAMS.SHOW_ALL
	},
	CLOUDRONE.templates.drone_show);
      }
      else if ($(this).val() == 'showDronesUser') {
	WORKER_COMM.doShowDrones({
	  show : CLOUDRONE.SHOWPARAMS.SHOW_USER,
	  user : localStorage.id
	},
	CLOUDRONE.templates.drone_show);
      }
      else if ($(this).val() == 'showDronesFree') {
	WORKER_COMM.doShowDrones({
	  show : CLOUDRONE.SHOWPARAMS.SHOW_FREE,
	},
	CLOUDRONE.templates.drone_show);
      }
    })
  },
  
};



